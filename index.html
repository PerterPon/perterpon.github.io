<!DOCTYPE HTML>

    <html lang="zh-Hans">
  
<head>
  <meta charset="utf-8">
  
  <title>PerterPon</title>
  <meta name="author" content="PerterPon">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="PerterPon"/>

  
    <meta property="og:image" content="undefined"/>
  

  
    <meta http-equiv="Content-Language" content="zh-Hans"/>
  

  <link href="/img/favicon.png" rel="icon">
  
    <link rel="apple-touch-icon" href="/img/apple-icon.png">
    <link rel="apple-touch-icon-precomposed" href="/img/apple-icon.png">
    

  <link rel="alternate" href="/atom.xml" title="PerterPon" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  
  <style type="text/css">
  /* Tim Pietrusky advanced checkbox hack (Android <= 4.1.2) */
body{ -webkit-animation: bugfix infinite 1s; }
@-webkit-keyframes bugfix { from {padding:0;} to {padding:0;} }

  
  <!-- Chinese readability improvements -->
    article {font-weight: 400;letter-spacing: .01rem;}
    article .entry{line-height:2;}
  

  
    article .post-content-index .entry{max-height: 550px; overflow:hidden;}
  
</style>

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56202861-1', 'auto');
  ga('send', 'pageview');
 
</script>




  
    <!-- 360 Font and Baidu CDN in China -->
    
      <link href='http://fonts.useso.com/css?family=Open+Sans:300,400|Playball' rel='stylesheet' type='text/css'>
    
  <link href='http://apps.bdimg.com/libs/fontawesome/4.1.0/css/font-awesome.css' rel='stylesheet' type='text/css'>
  <script src="http://libs.baidu.com/jquery/1.11.1/jquery.min.js"></script>
  



</head>


<body>
  <header id="header" class="inner"><div class="padding">
	<div class="alignleft logo">
	  <h1><a href="/">PerterPon</a></h1>
	</div>
	<nav id="main-nav" class="alignright">
		<input type="checkbox" id="toggle" />
		<label for="toggle" class="toggle" data-open="Main Menu" data-close="Close Menu" onclick><i class="fa fa-bars"></i></label>
	  <ul class="menu">
	    
	      <li><a href="/">Home</a></li>
	    
	      <li><a href="/archives">Archives</a></li>
	    
	    
	  </ul>
	</nav>
	<div class="clearfix"></div>
</div>
</header>
  <div id="page-heading-wrap">
  	<div class="inner">
      <div class="padding">
    		
          <h2>Gone With the Wind</h2>
        
      </div>
  	</div>
  </div>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper" class="padding">
  <article class="post">
  
  
    <div class="post-content-index">
  
      
        <header>
          <div class="icon"></div>
            
    
      <h1 class="title transition"><a href="/2016/12/07/effective-pixel/">获取最小有效像素区域</a></h1>
    
  
          <ul>
            <li>
              <span class="heading-span">Posted on: </span>
              <time datetime="2016-12-07T09:41:00.000Z">2016-12-07</time>
            </li>
            
              <li>
                <span class="heading-span">By: </span>

                
                  <a href="/">PerterPon</a>
                

              </li>
            
            <li>
              <span class="heading-span">With: </span>
              

                <a href="/2016/12/07/effective-pixel/#ds-thread"><span class="ds-thread-count" data-thread-key="2016/12/07/effective-pixel/" data-count-type="comments"></span></a>
              
          </ul>
        </header>
      
      <div class="entry">
        
          
            <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>最近在做一个需求是对页面某一块区域截图，本身没什么，但是发现需要截图的区域非常大，然后里面的内容通常只有一小点，这样我把整张图片拿出去就会发现只有中间一点点有东西，其他地方都是空白的，用户体验就会比较差了，记得PhotoShop里面有一个功能是能截取整张图片的最小有效像素区域，本来以为canvas自带有这种功能，没想到还是要自己实现的，虽然功能很简单，但是网上也没找着相应类库，可能是我搜索的姿势不对，或者这个需求实在太简单了，没人封装成类库了，虽然完全没做过图像处理，也开始找一些资料。</p>
<p>文字描述比较抽象，放上一张图片。</p>
<h4 id="原始图片"><a href="#原始图片" class="headerlink" title="原始图片"></a>原始图片</h4><p><img src="/image/origin.png" alt="原始图片"></p>
<h4 id="处理后图片"><a href="#处理后图片" class="headerlink" title="处理后图片"></a>处理后图片</h4><p><img src="/image/translate.png" alt="处理后图片"></p>
<h2 id="canvas"><a href="#canvas" class="headerlink" title="canvas"></a>canvas</h2><p>网页内容是用<code>Html2Canvas</code>把DOM截图成了canvas，原理不是很清楚，大概是读取DOM样式然后在<code>canvas</code>里面重新画一遍，这不是重点，这个时候我们已经拿到画成了的canvas了，改怎么处理呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var canvas  = document.getElementById( &#39;canvas&#39; );&#10;var ctx     = canvas.getContext( &#39;2d&#39; );&#10;var imgData = ctx.getImageData( 0, 0, canvas.width, canvas.height );</span><br></pre></td></tr></table></figure>
<p>通过<code>getImageData</code>方法就能够拿到<code>canvas</code>的原始像素点信息了，四个参数描述了一个矩形，返回的像素点信息就是这个矩形内的信息。</p>
<p>返回的是一个<code>Uint8ClampedArray</code>，<code>Uint8ClampedArray</code>是<code>JavaScript</code>中的类型数组，具体的可以参看<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array" target="_blank" rel="external">这里</a>，简单来看就是这个数组中的元素都是<code>unsigned int</code>并且都是8位的，所以取值范围是<code>0~255</code>，非常适合用来存放ImageData，而且类型数组因为类型都是确定的，使用起来比普通数组速度上会快很多。</p>
<h2 id="ImageData"><a href="#ImageData" class="headerlink" title="ImageData"></a>ImageData</h2><p>拿到了原始的像素点数据，来看看数据长什么样子，首先看数组长度，假设是一个100X100的图片，那么理论上像素点的数量是100<em>100，也就是10000个，拿到ImageData的数组看长度其实有40000，简单猜测一下大概是10000 </em> rgba，看具体的数组内容很容易就能够验证我们的猜想。</p>
<p>一个典型的<code>ImageData</code>大概长这个样子，这是一个从左往右，从上到下按顺序排列的一个数组：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">imageData = [ &#10;              0,   0,   0,   0,&#10;              255, 255, 255, 1,&#10;              122, 122, 122, 0.5,&#10;              ....&#10;            ];</span><br></pre></td></tr></table></figure>
<h2 id="如何获取最小像素区域？"><a href="#如何获取最小像素区域？" class="headerlink" title="如何获取最小像素区域？"></a>如何获取最小像素区域？</h2><p>要实现这个功能的本质，其实就是如何寻找最上、最右、最下以及最左四个点(P1,P2,P3,P4)，有了这四个点，我们就能画出一个最小矩形，把这个图像框在里面。</p>
<h3 id="一维组数映射到二维空间"><a href="#一维组数映射到二维空间" class="headerlink" title="一维组数映射到二维空间"></a>一维组数映射到二维空间</h3><p>根据数组下标计算当前点在二维空间的坐标，方法其实很简单。</p>
<p>看下面这张图，可以认为这是一张 5X4 的一张图片，那么总共就有20个像素点，每个格子里的<code>0-19</code>数字就意味着这是在一维数组里面的下标<code>N</code>，由此可得</p>
<p>X = N % width;<br>Y = Math.floor( N / width );</p>
<p><img src="/image/pixels.png" alt="pixel"></p>
<h3 id="全数组扫描"><a href="#全数组扫描" class="headerlink" title="全数组扫描"></a>全数组扫描</h3><p>首先能想到的最简单的办法，就是循环整个数组，当<code>alpha</code>值大于0的时候，即可判断这个点是一个有效像素点，然后整个数组循环完成之后，即可知道得到P1,P2,P3,P4四个点。</p>
<p>以下是实现代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function getEffectiveRect( imageData, width, height ) &#123;&#10;  // &#19978;&#28857;, Y&#20540;&#26368;&#23567;&#10;  var p1 = [ 0, height ];&#10;  // &#21491;&#28857;, X&#20540;&#26368;&#22823;&#10;  var p2 = [ 0, 0 ];&#10;  // &#19979;&#28857;, Y&#20540;&#26368;&#22823;&#10;  var p3 = [ 0, 0 ];&#10;  // &#24038;&#28857;, X&#20540;&#26368;&#23567;&#10;  var p4 = [ width, 0 ];&#10;&#10;  var data    = imageData.data;&#10;  var number  = 0;&#10;  console.time( &#39;image1&#39; );&#10;  for ( var i = 0; i &#60; data.length; i ) &#123;&#10;    number++;&#10;    var r = data[ i++ ];&#10;    var g = data[ i++ ];&#10;    var b = data[ i++ ];&#10;    var a = data[ i++ ];&#10;    if ( a === 0 ) &#123;&#10;      continue;&#10;    &#125;&#10;    var x = number % width;&#10;    var y = ( number - x ) / width;&#10;    if ( p1[ 1 ] &#62; y ) &#123;&#10;      p1[ 0 ] = x;&#10;      p1[ 1 ] = y;&#10;    &#125;&#10;&#10;    if ( p2[ 0 ] &#60; x ) &#123;&#10;      p2[ 0 ] = x;&#10;      p2[ 1 ] = y;&#10;    &#125;&#10;&#10;    if ( p3[ 1 ] &#60; y ) &#123;&#10;      p3[ 0 ] = x;&#10;      p3[ 1 ] = y;&#10;    &#125;&#10;&#10;    if ( p4[ 0 ] &#62; x ) &#123;&#10;      p4[ 0 ] = x;&#10;      p4[ 1 ] = y;&#10;    &#125;&#10;  &#125;&#10;&#10;  return &#123; p1, p2, p3, p4 &#125;;&#10;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="从矩形的四个角分别去寻找"><a href="#从矩形的四个角分别去寻找" class="headerlink" title="从矩形的四个角分别去寻找"></a>从矩形的四个角分别去寻找</h3><p>具体的思路如下图：</p>
<p><img src="/image/from-rect.png" alt="from-rect"></p>
<p>理论上只要有效像素区域越大，那么需要计算的量就越少，速度也就越快，以下是我的实现代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function getEffectiveRect2( imageData, width, height ) &#123;&#10;  var data = imageData.data;&#10;&#10;  console.time( &#39;image2&#39; );&#10;  var p1 = [];&#10;  var p2 = [];&#10;  var p3 = [];&#10;  var p4 = [];&#10;&#10;  // &#23547;&#25214;P1&#10;  var len = 0&#10;  for ( var i = 0; i &#60; data.length / 4; i ++ ) &#123;&#10;    len   += 7;&#10;    var a = data[ len ];&#10;    if ( a !== 0 ) &#123;&#10;      var x = i % width;&#10;      var y = ( i - x ) / width;&#10;      p1    = [ x, y ];&#10;      break;&#10;    &#125;&#10;  &#125;;&#10;&#10;  //&#23547;&#25214;P3&#10;  var len = 0;&#10;  for ( var i = data.length / 4 - 1; i &#62;= 0; i -- ) &#123;&#10;    len  += 7;&#10;    var a = data[ len ];&#10;    if ( a !== 0 ) &#123;&#10;      var x = i % width;&#10;      var y = ( i - x ) / width;&#10;      p3    = [ x, y ];&#10;      break;&#10;    &#125;&#10;  &#125;&#10;&#10;  // &#23547;&#25214;P2&#10;  for ( var i   = width - 1; i &#62;= 0; i -- ) &#123;&#10;    if ( p2.length ) &#123;&#10;      break;&#10;    &#125;&#10;    var a = p1[ 1 ];&#10;    var b = p3[ 1 ];&#10;    var len = i + a * width;&#10;    for ( var j = a; j &#60; b; j ++ ) &#123;&#10;      len += width;&#10;      // var point = i + j * width;&#10;      var point = len;&#10;      var a = data[ point * 4 + 3 ];&#10;      if ( a !== 0 ) &#123;&#10;        var x = point % width;&#10;        var y = ( point - x ) / height;&#10;        p2    = [ x, y ];&#10;        break;&#10;      &#125;&#10;    &#125;&#10;  &#125;;&#10;&#10;  // &#23547;&#25214;P4&#10;  for ( var i = 0; i &#60; width; i ++ ) &#123;&#10;    if ( p4.length ) &#123;&#10;      break;&#10;    &#125;&#10;    for ( var j = p1[ 1 ]; j &#60; p3[ 1 ]; j ++ ) &#123;&#10;      var point = i + j * width;&#10;      var a = data[ point * 4 + 3 ];&#10;      if ( a !== 0 ) &#123;&#10;        var x = point % width;&#10;        var y = ( point - x ) / height;&#10;        p4    = [ x, y ];&#10;        break;&#10;      &#125;&#10;    &#125;&#10;  &#125;&#10;&#10;  return &#123; p1, p2, p3, p4 &#125;;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>将两种方法分别去计算最开头的图片，两种方式的计算时间分别是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">image1: 10.83ms&#10;image2: 15.32ms</span><br></pre></td></tr></table></figure>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>方法2引入的复杂的逻辑反而降低了计算时间，逻辑最简单的全数组扫描比第二种方式快了30%，因为涉及到的东西比较多，目前还不清楚到底是什么原因导致第二种方式速度如此慢，测试了一下，只有当一整张图片几乎全部有像素点的时候，两种方法的速度才差不多。后续我会继续寻找原因，猜测可能是方法2的计算量比方法1多，而方法1更多的是比较和赋值。</p>

          
        
      </div>
      <footer>
        
          <div class="alignright">
            <a href="/2016/12/07/effective-pixel/#more" class="more-link">Continue Reading<i class="fa fa-long-arrow-right fa-1"></i></a>
          </div>
        
        <div class="clearfix"></div>
      </footer>
    </div>
</article>




  <article class="post">
  
  
    <div class="post-content-index">
  
      
        <header>
          <div class="icon"></div>
            
    
      <h1 class="title transition"><a href="/2016/11/23/computer-number/">计算机眼中的数字</a></h1>
    
  
          <ul>
            <li>
              <span class="heading-span">Posted on: </span>
              <time datetime="2016-11-23T11:19:00.000Z">2016-11-23</time>
            </li>
            
              <li>
                <span class="heading-span">By: </span>

                
                  <a href="/">PerterPon</a>
                

              </li>
            
            <li>
              <span class="heading-span">With: </span>
              

                <a href="/2016/11/23/computer-number/#ds-thread"><span class="ds-thread-count" data-thread-key="2016/11/23/computer-number/" data-count-type="comments"></span></a>
              
          </ul>
        </header>
      
      <div class="entry">
        
          
            <h2 id="0-1-0-2"><a href="#0-1-0-2" class="headerlink" title="0.1 + 0.2 = ?"></a>0.1 + 0.2 = ?</h2><p>即使是没上过学的人，也知道答案是0.3，但是，在看似无所不能，计算速度远超人类的计算机来说，答案就不是0.3了。看看chrome下的结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0.1 + 0.2&#10;&#10;0.30000000000000004</span><br></pre></td></tr></table></figure>
<p>再看看python：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Python 2.7.10 (default, Jul 30 2016, 18:31:42) &#10;[GCC 4.2.1 Compatible Apple LLVM 8.0.0 (clang-800.0.34)] on darwin&#10;Type &#34;help&#34;, &#34;copyright&#34;, &#34;credits&#34; or &#34;license&#34; for more information.&#10;&#62;&#62;&#62; 0.1 + 0.2&#10;0.30000000000000004&#10;&#62;&#62;&#62;</span><br></pre></td></tr></table></figure>
<p>再试试C语言：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#include &#34;stdio.h&#34;&#10; &#10;  int main()&#123;&#10;&#10;  double a = 0.1 + 0.2;&#10;  printf( &#34;%.17lf&#34;, a );&#10;&#10;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0.30000000000000004</span><br></pre></td></tr></table></figure>
<p><img src="/image/black-question.jpg" alt="qustion"></p>
<h2 id="产生原因"><a href="#产生原因" class="headerlink" title="产生原因"></a>产生原因</h2><p>对于数字的存储绝大多数语言遵循的都是<a href="http://grouper.ieee.org/groups/754/" target="_blank" rel="external">IEEE 754</a>规范，简单来说就是一些革命先烈告诉你当你在二进制计算机中想要一个浮点数的时候应该如何去表达。</p>
<p>首先，内存是有限的，所以一个数字，当它声明好了之后所占的位数是固定的，比如在C语言中，<code>double</code>类型所占的字节数是8，那么总共就是64位(可能某些奇葩编译器会有些差异)，革命先烈们是怎么规定的呢？</p>
<p><img src="/image/float.png" alt="double"></p>
<p>有一个通用的计算公式：</p>
<p><img src="/image/float-cal.png" alt="float-cal"></p>
<ol>
<li>(-1)^s表示符号位，当s=0，V为正数；当s=1，V为负数。</li>
<li>M表示有效数字，大于等于1，小于2。</li>
<li>2^E表示指数位。</li>
</ol>
<p>举例来说，十进制的5.0，写成二进制是101.0，相当于1.01×2^2。那么，按照上面V的格式，可以得出s=0，M=1.01，E=2。<br>十进制的-5.0，写成二进制是-101.0，相当于-1.01×2^2。那么，s=1，M=1.01，E=2。</p>
<p>有几点需要注意：</p>
<ul>
<li><p>因为有效数字M的第一位必然是1，所以存储的时候就把这一位舍去了，可以空出一位用来存储，在计算的时候加回来就行了。</p>
</li>
<li><p>指数E没有符号位，无法表示负数，所以在计算的时候减去一个半数，比如：double是64位，11位用来存储指数，假设你要保存指数10，那么就必须存储<code>1023 + 10</code>，也就是<code>10000001001</code>。ps: 以上讨论的都是64位浮点数，如果是float，也就是32位的浮点数，指数位数是8，保存指数10就是:<code>127 + 10</code></p>
</li>
</ul>
<p>对于指数E，还有一下三条更细的规则：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#65288;1&#65289;E&#19981;&#20840;&#20026;0&#25110;&#19981;&#20840;&#20026;1&#12290;&#36825;&#26102;&#65292;&#25351;&#25968;E&#30340;&#35745;&#31639;&#20540;&#20943;&#21435;127&#65288;&#25110;1023&#65289;&#65292;&#24471;&#21040;&#30495;&#23454;&#20540;&#65292;&#20877;&#23558;&#26377;&#25928;&#25968;&#23383;M&#21069;&#21152;&#19978;&#31532;&#19968;&#20301;&#30340;1&#12290;&#10;&#65288;2&#65289;E&#20840;&#20026;0&#12290;&#36825;&#26102;&#65292;&#28014;&#28857;&#25968;&#30340;&#25351;&#25968;E&#31561;&#20110;1-127&#65288;&#25110;&#32773;1-1023&#65289;&#65292;&#26377;&#25928;&#25968;&#23383;M&#19981;&#20877;&#21152;&#19978;&#31532;&#19968;&#20301;&#30340;1&#65292;&#32780;&#26159;&#36824;&#21407;&#20026;0.xxxxxx&#30340;&#23567;&#25968;&#12290;&#36825;&#26679;&#20570;&#26159;&#20026;&#20102;&#34920;&#31034;&#177;0&#65292;&#20197;&#21450;&#25509;&#36817;&#20110;0&#30340;&#24456;&#23567;&#30340;&#25968;&#23383;&#12290;&#10;&#65288;3&#65289;E&#20840;&#20026;1&#12290;&#36825;&#26102;&#65292;&#22914;&#26524;&#26377;&#25928;&#25968;&#23383;M&#20840;&#20026;0&#65292;&#34920;&#31034;&#177;&#26080;&#31351;&#22823;&#65288;&#27491;&#36127;&#21462;&#20915;&#20110;&#31526;&#21495;&#20301;s&#65289;&#65307;&#22914;&#26524;&#26377;&#25928;&#25968;&#23383;M&#19981;&#20840;&#20026;0&#65292;&#34920;&#31034;&#36825;&#20010;&#25968;&#19981;&#26159;&#19968;&#20010;&#25968;&#65288;NaN&#65289;&#12290;</span><br></pre></td></tr></table></figure>
<h4 id="好了，说完了背景，那么就可以来看看到底是什么原因了。"><a href="#好了，说完了背景，那么就可以来看看到底是什么原因了。" class="headerlink" title="好了，说完了背景，那么就可以来看看到底是什么原因了。"></a>好了，说完了背景，那么就可以来看看到底是什么原因了。</h4><p>整数的二进制和十进制之间的相互转换，相信大家都会算，小数部分，很多人可能已经忘记如何计算了。</p>
<p>总体来说就是 <strong>乘二取整</strong>，比如0.1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0.1 * 2&#10;0.2      &#62;&#62; 0&#10;0.2 * 2&#10;0.4      &#62;&#62; 0&#10;0.4 * 2&#10;0.8      &#62;&#62; 0&#10;0.8 * 2&#10;1.6      &#62;&#62; 1&#10;0.6 * 2&#10;1.2      &#62;&#62; 1&#10;&#10;0.2 * 2&#10;0.4      &#62;&#62; 0&#10;0.4 * 2&#10;0.8      &#62;&#62; 0&#10;0.8 * 2&#10;1.6      &#62;&#62; 1&#10;......</span><br></pre></td></tr></table></figure>
<p>0.1 变成了 <code>0.0001 1001 1001 1001 ....</code> 1001无限循环<br>0.2 变成了 <code>0.0011 0011 0011 0011 ....</code> 0011无限循环</p>
<p>对于计算机来说，0.1和0.2的二进制就变成了一个无尽数，其实大部分小数转换成二进制都是无穷数。于是，二进制的0.1和0.2就变成了：</p>
<p>竖线后面代表存储位数之外   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0.0001 1001 1001 ...... 1001 | 1001   &#10;0.0011 0011 0011 ...... 0011 | 0011</span><br></pre></td></tr></table></figure>
<p>二进制相加之后变成了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">...... 1100 | 1100</span><br></pre></td></tr></table></figure>
<p>由于存储位数限制，必须舍去竖线后面的有效数字，按照舍0进1的方式，就变成了 <code>.... 1101</code>，所以整个二进制数字就变成了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0.0100 1100 1100 1100 1100 1100 1100 1100 1100 1100 1100 1100 1101</span><br></pre></td></tr></table></figure>
<p>转换成十进制就是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0.30000000000000004440892098500626</span><br></pre></td></tr></table></figure>
<p>就变成了我们最初所看到的结果。</p>
<p>至此，我们开头的问题已经有了答案，那么下面有几个引申问题：</p>
<ul>
<li>JS中类型存储位是52位，那么可以准确表达最大的数字就是：Math.pow(2, 53), 也就是：<code>9007199254740992</code>，那么以下几个表达式的值是什么呢？</li>
</ul>
<p>9007199254740992 + 1<br>9007199254740992 + 2<br>9007199254740992 + 3<br>9007199254740992 + 4</p>
<ul>
<li>0.1, 0.2, 0.3, 0.4 转换成二进制小数都是无穷的，那么以下表达式的结果如何呢？</li>
</ul>
<p>0.1 + 0.2 === 0.3<br>0.1 + 0.3 === 0.4<br>0.2 + 0.4 === 0.6<br>0.2 + 0.3 === 0.5</p>

          
        
      </div>
      <footer>
        
          <div class="alignright">
            <a href="/2016/11/23/computer-number/#more" class="more-link">Continue Reading<i class="fa fa-long-arrow-right fa-1"></i></a>
          </div>
        
        <div class="clearfix"></div>
      </footer>
    </div>
</article>




  <article class="post">
  
  
    <div class="post-content-index">
  
      
        <header>
          <div class="icon"></div>
            
    
      <h1 class="title transition"><a href="/2016/11/23/async/">相对性推进引擎(emDrive)</a></h1>
    
  
          <ul>
            <li>
              <span class="heading-span">Posted on: </span>
              <time datetime="2016-11-23T09:35:00.000Z">2016-11-23</time>
            </li>
            
              <li>
                <span class="heading-span">By: </span>

                
                  <a href="/">PerterPon</a>
                

              </li>
            
            <li>
              <span class="heading-span">With: </span>
              

                <a href="/2016/11/23/async/#ds-thread"><span class="ds-thread-count" data-thread-key="2016/11/23/async/" data-count-type="comments"></span></a>
              
          </ul>
        </header>
      
      <div class="entry">
        
          
            
          
        
      </div>
      <footer>
        
          <div class="alignright">
            <a href="/2016/11/23/async/#more" class="more-link">Continue Reading<i class="fa fa-long-arrow-right fa-1"></i></a>
          </div>
        
        <div class="clearfix"></div>
      </footer>
    </div>
</article>




  <article class="post">
  
  
    <div class="post-content-index">
  
      
        <header>
          <div class="icon"></div>
            
    
      <h1 class="title transition"><a href="/2016/11/23/em-drive/"></a></h1>
    
  
          <ul>
            <li>
              <span class="heading-span">Posted on: </span>
              <time datetime="2016-11-23T09:34:42.000Z">2016-11-23</time>
            </li>
            
              <li>
                <span class="heading-span">By: </span>

                
                  <a href="/">PerterPon</a>
                

              </li>
            
            <li>
              <span class="heading-span">With: </span>
              

                <a href="/2016/11/23/em-drive/#ds-thread"><span class="ds-thread-count" data-thread-key="2016/11/23/em-drive/" data-count-type="comments"></span></a>
              
          </ul>
        </header>
      
      <div class="entry">
        
          
            
          
        
      </div>
      <footer>
        
          <div class="alignright">
            <a href="/2016/11/23/em-drive/#more" class="more-link">Continue Reading<i class="fa fa-long-arrow-right fa-1"></i></a>
          </div>
        
        <div class="clearfix"></div>
      </footer>
    </div>
</article>




  <article class="post">
  
  
    <div class="post-content-index">
  
      
        <header>
          <div class="icon"></div>
            
    
      <h1 class="title transition"><a href="/2016/11/16/ios-basic/">iOS开发--1天从入门到放弃--基础</a></h1>
    
  
          <ul>
            <li>
              <span class="heading-span">Posted on: </span>
              <time datetime="2016-11-16T06:46:00.000Z">2016-11-16</time>
            </li>
            
              <li>
                <span class="heading-span">By: </span>

                
                  <a href="/">PerterPon</a>
                

              </li>
            
            <li>
              <span class="heading-span">With: </span>
              

                <a href="/2016/11/16/ios-basic/#ds-thread"><span class="ds-thread-count" data-thread-key="2016/11/16/ios-basic/" data-count-type="comments"></span></a>
              
          </ul>
        </header>
      
      <div class="entry">
        
          
            <p>写了一段时间的iOS，把iOS和javascript在各方面做一下对比，记录一些比较基础的东西。</p>
<h2 id="iOS开发包含哪些东西？"><a href="#iOS开发包含哪些东西？" class="headerlink" title="iOS开发包含哪些东西？"></a>iOS开发包含哪些东西？</h2><ul>
<li>二门语言：Objective-C，Swift</li>
<li>一个基础框架：Cocoa Touch</li>
<li>一个IDE：XCode</li>
</ul>
<h2 id="我需要准备哪些东西？"><a href="#我需要准备哪些东西？" class="headerlink" title="我需要准备哪些东西？"></a>我需要准备哪些东西？</h2><ul>
<li>Mac电脑，身残志坚的朋友可以选择黑苹果。</li>
<li>最好有一台iPhone，身残志坚的朋友没得选了，通常在模拟器里面没问题的东西在真机里面会有一些诡异的问题，特别是涉及到摄像头以及麦克风等等硬件的时候。</li>
</ul>
<h2 id="新建一个iOS应用"><a href="#新建一个iOS应用" class="headerlink" title="新建一个iOS应用"></a>新建一个iOS应用</h2><p>打开xcode，选择红框中的项目。</p>
<p><img src="/image/create_project.png" alt="创建项目"></p>
<p>然后选择<code>Single View Application</code>，顾名思义：单页应用。</p>
<p>取个名字：<code>IOS-dev-demo</code>，然后选择保存的地方，一个新的iOS应用就创建好了。</p>
<p><img src="/image/create_folder.png" alt="创建文件夹"></p>
<p>xcode会自动帮我们创建四个group，分别是<code>IOS-dev-demo</code>，<code>IOS-dev-demoTests</code>，<code>IOS-dev-demoUITests</code>，<code>products</code>，作用如下：</p>
<ul>
<li>IOS-dev-demo 项目的主目录，所有的项目业务代码都保存在这个group下。</li>
<li>IOS-dev-demoTests 单元测试目录。</li>
<li>IOS-dev-demoUITests UI测试目录。</li>
<li>Products 相关编译文件保存目录。</li>
</ul>
<p>基本我们用到最多的就是我们的项目主目录了。</p>
<h2 id="运行我们的项目"><a href="#运行我们的项目" class="headerlink" title="运行我们的项目"></a>运行我们的项目</h2><p><img src="/image/run.png" alt="运行按钮"></p>
<p><code>CMD+R</code> 或者点击左上方三角形的运行按钮，即可在模拟器上运行，刚创建好只是一个空的应用。</p>
<h2 id="搭建我们的应用"><a href="#搭建我们的应用" class="headerlink" title="搭建我们的应用"></a>搭建我们的应用</h2><p>为什么用<code>搭建</code>这个词呢，因为<code>Cocoa Touch</code>已经帮助我们封装好了很多内部组件，和安卓不同，<code>Cocoa Touch</code>的内部组件通常都有一个比较好的交互和外观，典型应用是<code>微信</code>，微信基本都使用了内部组件，内部组件也最符合用户使用习惯。</p>
<p>搭建界面有两种方式：</p>
<ol>
<li>storyboard，可视化组件拖拉，类似于Dreamweaver，这种方式不做介绍了，快速搭建应用首选，也存在些许弊端，有兴趣的可以看看<a href="http://www.jianshu.com/p/aaa4b89dbba1" target="_blank" rel="external">这篇文章</a>。</li>
<li>纯代码，类似于手写HTML代码。</li>
</ol>
<h2 id="如何添加组件？"><a href="#如何添加组件？" class="headerlink" title="如何添加组件？"></a>如何添加组件？</h2><p>拿一个<code>button</code>组件来说，在<code>ViewController</code>类中的<code>viewDidLoad</code>方法中添加如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UIButton *button = [[UIButton alloc] init];&#10;button.frame     = CGRectMake(100, 100, 100, 50);&#10;[button setTitle:@&#34;&#25353;&#38062;&#27979;&#35797;&#34; forState:UIControlStateNormal];&#10;[button setTitleColor:[UIColor blackColor] forState:UIControlStateNormal];&#10;&#10;[self.view addSubview:button];</span><br></pre></td></tr></table></figure>
<p>重新编译运行一下我们的代码，就可以看到一个黑色的按钮在界面上了，那么这一段代码是如何工作的呢？我又如何为何一定要在这个函数里面添加这段代码？</p>
<p>下面用浏览器的方式展示如何添加一个按钮，相信大家一定都非常熟悉了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let button = document.createElement( &#39;button&#39; );&#10;button.textContent  = &#39;&#25353;&#38062;&#27979;&#35797;&#39;&#10;button.style.width  = &#39;100px&#39;;&#10;button.style.height = &#39;50px&#39;;&#10;button.style.margin-left   = &#39;100px&#39;;&#10;button.style.margin-top    = &#39;100px&#39;;&#10;button.style.color  = &#39;rgb(0, 0, 0)&#39;&#10;&#10;document.body.appendChild( button );</span><br></pre></td></tr></table></figure>
<p>对比一下两段代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// &#21019;&#24314;&#19968;&#20010;&#32452;&#20214;&#10;UIButton *button = [[UIButton alloc] init];                                ||| let button = document.createElement( &#39;button&#39; );&#10;&#10;// &#35774;&#32622;&#32452;&#20214;&#30340;left, top, width, height&#23646;&#24615;&#10;button.frame     = CGRectMake(100, 100, 100, 50);                          ||| button.style.width  = &#39;100px&#39;;&#10;                                                                           ||| button.style.height = &#39;50px&#39;;&#10;                                                                           ||| button.style.margin-left   = &#39;100px&#39;;&#10;                                                                           ||| button.style.margin-top    = &#39;100px&#39;;&#10;&#10;// &#35774;&#32622;&#32452;&#20214;&#30340;&#39;&#26631;&#39064;&#39;&#23646;&#24615;&#10;[button setTitle:@&#34;&#25353;&#38062;&#27979;&#35797;&#34; forState:UIControlStateNormal];                 ||| button.textContent  = &#39;&#25353;&#38062;&#27979;&#35797;&#39;&#10;&#10;// &#35774;&#32622;&#32452;&#20214;&#26631;&#39064;&#30340;&#39068;&#33394;&#10;[button setTitleColor:[UIColor blackColor] forState:UIControlStateNormal]; ||| button.style.color  = &#39;rgb(0, 0, 0)&#39;&#10;&#10;// &#23558;&#32452;&#20214;&#28155;&#21152;&#21040;&#24403;&#21069;&#30011;&#24067;&#19978;&#10;[self.view addSubview:button];                                             ||| document.body.appendChild( button );</span><br></pre></td></tr></table></figure>
<p>其实从逻辑上来看两段代码非常相似，唯一不同的仅仅是语法而已。</p>
<h3 id="那么从系统层面看，两者如何？"><a href="#那么从系统层面看，两者如何？" class="headerlink" title="那么从系统层面看，两者如何？"></a>那么从系统层面看，两者如何？</h3><p>首先来看看html</p>
<p><img src="/image/html-c.png" alt="htmlc"></p>
<p>再看看iOS</p>
<p><img src="/image/cocoa-c.png" alt="cocoac"></p>
<p>依然非常地相似，那么这两段代码唯一不同的就是语言了，让我们看看<code>Objective-c</code>的特性</p>
<h2 id="Objective-c"><a href="#Objective-c" class="headerlink" title="Objective-c"></a>Objective-c</h2><p>从名字上可以见，<code>Objective-c</code>就是对象化的C语言，所以支持C语言，同时扩展了一些面向对象的内容，比如：<code>Class</code>。</p>
<p><code>Objective-c</code>与类C类的语言的一个比较大的区别是，<code>Objective-c</code>使用消息传递模型，从如下代码可以看出：</p>
<p>假设我要调用<code>car</code>实例的<code>move</code>方法，</p>
<p>C++</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">car.move();</span><br></pre></td></tr></table></figure>
<p>Objective-c</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[car move];</span><br></pre></td></tr></table></figure>
<p>从语法上可以看出一二，C++中确实是调用了<code>car</code>实例的<code>move</code>方法，如果<code>car</code>实例没有这个方法，那么编译期间就会报错，但是<code>Objective-c</code>仅仅是向<code>car</code>实例发送了一个<code>move</code>消息，代码只会在运行时去检查<code>car</code>实例到底有没有能力对<code>move</code>消息进行回应，从中可以看出<code>Objective-c</code>是一门动态语言。</p>
<h2 id="响应UI事件"><a href="#响应UI事件" class="headerlink" title="响应UI事件"></a>响应UI事件</h2><p>通常在页面上放置了一个按钮并不是为了展示信息，而是为了能让用户进行交互，那么来看看两者如何进行UI响应。</p>
<p><code>Javascript</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">button.addEventListener( &#39;click&#39;, function( event ) &#123;&#10;  alert( &#39;clicked&#39; );&#10;&#125; );</span><br></pre></td></tr></table></figure>
<p>拿到<code>button</code>对象，然后给这个button注册一个名字叫<code>click</code>的事件，再给这个注册方法一个回调函数，然后用户在这个按钮上单击的话，就能够触发这个回调函数了。</p>
<p><code>Objective-c</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[button addTarget:self action:@selector(clickHandler:) forControlEvents:UIControlEventTouchUpInside];</span><br></pre></td></tr></table></figure>
<p>调用<code>button</code>对象的<code>addTarget</code>方法，为<code>UIControlEventTouchUpInside</code>事件，也就是单击事件添加<code>self</code>也就是当前实例下的<code>clickHandler</code>作为事件处理函数。这里也可以选择别的类的方法，只要<code>selector</code>中的方法名能在<code>addTarget</code>对象中找到就行。<br><code>iOS</code>中只能使用类的方法作为事件处理函数，没法使用类似匿名函数的<code>block</code>来进行事件处理。</p>
<h2 id="回调"><a href="#回调" class="headerlink" title="回调"></a>回调</h2><p><code>Javascript</code>中发送一个http请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let xhr = new XMLHttpRequest();&#10;xhr.open( &#39;GET&#39;, &#39;http://xxxx.com&#39; );&#10;xhr.send();&#10;&#10;xhr.onreadystatechange = function()&#123;&#10;  // do something&#10;&#125;</span><br></pre></td></tr></table></figure>
<p><code>Javascript</code>基于事件驱动，通常使用一个匿名函数来作为请求结束时候的回调函数。</p>
<p><code>Objective-c</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSURL *url = [NSURL URLWithString:@&#34;http://xxx.com&#34;];&#10;NSURLRequest *request = [NSURLRequest requestWithUrl:url];&#10;&#10;NSURLSession *session = [NSURLSession sharedSession];&#10;NSURLSessionDataTask *task = [session dataTaskWithRequest: request completionHandler: ^(NSData *data, NSURLResponse *response, NSError *error) &#123;&#10;         // ...&#10;     &#125;];</span><br></pre></td></tr></table></figure>
<p><code>Objective-c</code> 相对来说发送一个请求的方式稍微有一些复杂，看到<code>completionHandler</code>这个参数，这在<code>Objective-c</code>中被称为<code>block</code>，是一种类似于<code>Javascript</code>中的回调函数，当然也可以使用<code>typedef</code>声明一个<code>block</code>在多个场景下使用。</p>
<p>关于<code>block</code>更多的使用奥秘，可以<a href="http://www.cnblogs.com/biosli/archive/2013/05/29/iOS_Objective-C_Block.html" target="_blank" rel="external">点击查看这篇文章</a>。</p>
<h2 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h2><p>数据请求回来了，那么就要开始渲染页面了，<code>iOS</code>有良好的动画运行机制，可以比安卓更流畅地运行动画，良好的动画效果可以带来更好的用户体验。</p>
<p><code>Javascript</code></p>
<p>JS中动画效果大致有如下几种：</p>
<p>纯粹的JS实现的动画效果应该就只有如下一种了</p>
<ul>
<li><code>setTimeout</code>，定时更新形变达到每秒24次即可实现基本的动画效果。</li>
</ul>
<p>示例代码: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const width = 100;&#10;setTimeout( function() &#123;&#10;  width++;&#10;  button.style.width = `$&#123;width&#125;px`;&#10;&#125;, 16 );</span><br></pre></td></tr></table></figure>
<p>更多更高效的动画效果可以借助<code>HTML5</code>和<code>CSS3</code>来实现</p>
<ul>
<li><code>requestAnimationFrame</code>，保持和系统相同的刷新率，得到更好体验的同时，有更高的效率。</li>
<li>css中的<code>transition-duration</code>，效率非常高，可以直接调用GPU来进行渲染。</li>
</ul>
<p><code>Objective-c</code></p>
<p><code>iOS</code>中的动画主要是指<code>Core Animation</code>框架，<a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/CoreAnimation_guide/Introduction/Introduction.html" target="_blank" rel="external">这里是官方的文档</a>。</p>
<p>调用方式主要有以下三种：</p>
<ol>
<li>UIView 代码块调用</li>
<li>UIView [begin commit]模式</li>
<li>CoreAnimation中的类</li>
</ol>
<p>简单贴一下最简单也最常用的 UIView 代码块调用的方式，其他方式的详细调用可以<a href="http://blog.csdn.net/yixiangboy/article/details/47016829" target="_blank" rel="external">参考这里</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CGRect newFrame = button.frame;&#10;newFrame.size.width = 200;&#10;[UIView animateWithDuration:1 animations:^&#123;&#10;  button.frame = newFrame;        &#10;&#125;];</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>有了以上这些东西，你能已经能把一个小功能呢给串起来了，但是<code>iOS</code>还有更加强大实用的各种组件，<code>UINavigationController</code>，<code>UITableViewController</code>，<code>NSUrlSession</code>，还有各种全局事件派发，多线程GCD，以及处理音视频的<code>AVFoundation</code>，更多功能，请看进阶篇。</p>

          
        
      </div>
      <footer>
        
          <div class="alignright">
            <a href="/2016/11/16/ios-basic/#more" class="more-link">Continue Reading<i class="fa fa-long-arrow-right fa-1"></i></a>
          </div>
        
        <div class="clearfix"></div>
      </footer>
    </div>
</article>




  <article class="post">
  
  
    <div class="post-content-index">
  
      
        <header>
          <div class="icon"></div>
            
    
      <h1 class="title transition"><a href="/2016/07/19/dataplus-pai/">数加Pai（机器学习平台）的上手体验</a></h1>
    
  
          <ul>
            <li>
              <span class="heading-span">Posted on: </span>
              <time datetime="2016-07-19T03:21:00.000Z">2016-07-19</time>
            </li>
            
              <li>
                <span class="heading-span">By: </span>

                
                  <a href="/">PerterPon</a>
                

              </li>
            
            <li>
              <span class="heading-span">With: </span>
              

                <a href="/2016/07/19/dataplus-pai/#ds-thread"><span class="ds-thread-count" data-thread-key="2016/07/19/dataplus-pai/" data-count-type="comments"></span></a>
              
          </ul>
        </header>
      
      <div class="entry">
        
          
            <h2 id="数加pai"><a href="#数加pai" class="headerlink" title="数加pai"></a>数加pai</h2><p>数加pai是一个机器学习平台，提供可视化界面来操作算法，无需自己编写任何代码即可计算自己的数据。<br>如果你没有那么多数据也没有这种场景，那么选择一个外部算法平台也是一个不错的选择。</p>
<h2 id="kaggle"><a href="#kaggle" class="headerlink" title="kaggle"></a>kaggle</h2><p>一个类似阿里云天池的算法开发大赛平台，会定时发布各种任务，前几名有奖金，第一名$10W。</p>
<p>我们用这个平台上练手的项目来体验一下PAI。</p>
<p>找到首页中标着101的那一组，这些题目都是给你练手的，相对来说会比较简单一点，就选第一个，<code>Digit Recognizer</code>。</p>
<h3 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h3><p>这个题目的主要任务的数字识别，很多手写的数字，左边导航栏<code>home</code>-<code>data</code>，进去可以下载本次的训练数据: <code>train.csv</code>和测试数据: <code>test.csv</code>。</p>
<p>打开<code>train.csv</code>文件，主办方已经把需要识别的图片提取成像素值，直接训练就行了。</p>
<p>其中，一行代表一个数字的图片，第一列<code>lable</code>代表的是已经识别出来的具体的数字。</p>
<table>
<thead>
<tr>
<th>label</th>
<th>pixel0</th>
<th>pixel1</th>
<th>…..</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>0</td>
<td>186</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>0</td>
<td>186</td>
<td>100</td>
</tr>
<tr>
<td>…..</td>
<td>……</td>
<td>……</td>
<td>…..</td>
</tr>
</tbody>
</table>
<h3 id="寻找合适算法"><a href="#寻找合适算法" class="headerlink" title="寻找合适算法"></a>寻找合适算法</h3><p>这里我采用了<code>kNN</code>算法，具体可以<a href="https://zh.wikipedia.org/wiki/%E6%9C%80%E8%BF%91%E9%84%B0%E5%B1%85%E6%B3%95" target="_blank" rel="external">点击这里</a>查看算法详细介绍。</p>
<p>选择<code>kNN</code>是因为<code>kNN</code>算法比较好理解，对于我这种新手也比较容易看懂，缺点是<code>kNN</code>算法是惰性算法，计算时间会比较长。</p>
<h3 id="开始解题"><a href="#开始解题" class="headerlink" title="开始解题"></a>开始解题</h3><p>一开始我使用python的<code>numpy</code>包来进行解题，在本机跑了将近一个半小时之后，终于输出了结果，这里有两个缺点，一个是我要自己处理CSV文件，提取成数组给<code>kNN</code>算法组件，二来是笔记本性能捉襟见肘，想要调试算法参数每次都要等这么久简直不能忍，于是我想到<a href="http://pai.base.shuju.aliyun.com" target="_blank" rel="external">数加机器学习平台</a>。</p>
<h3 id="上传数据"><a href="#上传数据" class="headerlink" title="上传数据"></a>上传数据</h3><p>pai依赖于<code>MaxCompute</code>，所以要先开通<code>MaxCompute</code>，在数加里面可以开通，开通后建两张表<code>pai_test_train</code>和<code>pai_test_data</code>，分别对应训练数据和测试数据。</p>
<p>首先下载<a href="https://help.aliyun.com/document_detail/27991.html?spm=5176.product27797.6.217.2hjJzR" target="_blank" rel="external">MaxCompute CMD</a>，这里点击<code>新版客户端下载</code>，下载完成后，配置AK以及运行CMD，关于如何建表，请查看帮助文档，注意要把所有字段也建了，和<code>CSV</code>文件相对应，这里字段有段多，可以用一个脚本生成sql. 然后使用 <code>MaxCompute CMD</code>的<code>tunnel</code>命令上传CSV文件建表<code>odps@ my_test_project&gt; tunnel upload train.csv pai_test_train;</code>，还有测试数据表<code>odps@ my_test_project&gt; tunnel upload test.csv pai_test_data;</code></p>
<h3 id="使用pai来解题"><a href="#使用pai来解题" class="headerlink" title="使用pai来解题"></a>使用pai来解题</h3><p>从数加的管理控制台进入pai，然后按照以下步骤操作。</p>
<ol>
<li>新建一个实验，取名pai_test，这时候我们会得到一个空的实验，接下来就是往实验上拖组件。</li>
<li>首先选择数据源，在左侧表列表中选择刚刚新建的<code>pai_test_train</code>，<code>pai_test_data</code>，分别拖到右侧的实验图上。这里表同步机制有延迟，如果在所有表中找不到新建的表，可以尝试一下搜索。</li>
<li>这时候我们的训练表和测试表已经在实验中ready了，就需要去找我们的算法组件了，在<code>组件-机器学习-多分类</code>中，<code>K近邻</code>就是我们需要的算法组件，同样拖拉到实验中。</li>
<li>组件都已经准备好了，那么就需要告诉pai如果来运行你的组件了，同样采用拖拉的方式，在<code>pai_test_train</code>表的组件下方有个小白点，鼠标拖拉一下可以拉出一根线，把这个线连接到<code>K近邻</code>算法组件上方的右边白点上，两个组件已经关联完成，同理另外一个表连接到右边白点上。</li>
<li>接下来就是配置算法组件了，要告诉算法，哪些是我的标签列，哪些是我的特征列，点击<code>K近邻</code>算法组件，在右侧的算法配置界面中，<code>选择训练表特征列</code>，这里把除了<code>label</code>字段外的所有字段都勾上，因为<code>lable</code>列是我们的标签列。</li>
<li>在<code>选择训练表的标签列</code>中选择<code>label</code>字段，下面两个选项都是可选项，可以选择预测表的哪些特征别参与计算，还有产出表选择产出哪些字段，这些都可以选择默认，同理还有<code>参数设置</code>tab，如果对算法没什么研究，选择默认就可以了。</li>
<li>全部选择好了，点击下方的<code>运行</code>来进行计算。</li>
</ol>
<h3 id="产出数据"><a href="#产出数据" class="headerlink" title="产出数据"></a>产出数据</h3><p>运行成功后，会产出一张新表，名字带有随机性，通常格式是<code>pai_temp_5052_75767_1</code>，因为<code>kaggle</code>没有和阿里云的产品进行打通，这里我们需要把数据下载成CSV文件，然后进行上传。</p>
<ol>
<li>首先依然是通过<code>tunnel</code>命令进行下载: <code>odps@ my_test_project&gt; tunnel download pai_temp_5052_75767_1 -h true result.csv;</code>,<code>-h true</code>命令表示带上表头。</li>
<li>打开CSV文件，找到<code>prediction</code>字段，这个就是我们的预测结果了，然后就是上传<code>kaggle</code>了。</li>
<li>因为<code>kaggle</code>对上传的字段有要求，这样他才能统计出分数，需要一个csv文件，有两列<code>imageId</code>和<code>label</code>，<code>imageId</code>就是一列自增列，从<code>1</code>开始，<code>label</code>列就是我们的结果列。</li>
<li>打开<code>101</code>那个项目，找到<code>Make a submission</code>那一项，上传我们的CSV文件，就能得到分数了。</li>
<li>后续可以调整算法参数，慢慢改善算法，提高分数，提高排名，也可以尝试一下别的算法。</li>
</ol>

          
        
      </div>
      <footer>
        
          <div class="alignright">
            <a href="/2016/07/19/dataplus-pai/#more" class="more-link">Continue Reading<i class="fa fa-long-arrow-right fa-1"></i></a>
          </div>
        
        <div class="clearfix"></div>
      </footer>
    </div>
</article>




  <article class="post">
  
  
    <div class="post-content-index">
  
      
        <header>
          <div class="icon"></div>
            
    
      <h1 class="title transition"><a href="/2016/06/06/hello-world/">Hello World</a></h1>
    
  
          <ul>
            <li>
              <span class="heading-span">Posted on: </span>
              <time datetime="2016-06-06T12:59:41.000Z">2016-06-06</time>
            </li>
            
              <li>
                <span class="heading-span">By: </span>

                
                  <a href="/">PerterPon</a>
                

              </li>
            
            <li>
              <span class="heading-span">With: </span>
              

                <a href="/2016/06/06/hello-world/#ds-thread"><span class="ds-thread-count" data-thread-key="2016/06/06/hello-world/" data-count-type="comments"></span></a>
              
          </ul>
        </header>
      
      <div class="entry">
        
          
            <p>Welcome to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

          
        
      </div>
      <footer>
        
          <div class="alignright">
            <a href="/2016/06/06/hello-world/#more" class="more-link">Continue Reading<i class="fa fa-long-arrow-right fa-1"></i></a>
          </div>
        
        <div class="clearfix"></div>
      </footer>
    </div>
</article>




  <article class="post">
  
  
    <div class="post-content-index">
  
      
        <header>
          <div class="icon"></div>
            
    
      <h1 class="title transition"><a href="/2016/05/11/tcp-package-stick/">TCP的粘包和半包</a></h1>
    
  
          <ul>
            <li>
              <span class="heading-span">Posted on: </span>
              <time datetime="2016-05-11T12:53:00.000Z">2016-05-11</time>
            </li>
            
              <li>
                <span class="heading-span">By: </span>

                
                  <a href="/">PerterPon</a>
                

              </li>
            
            <li>
              <span class="heading-span">With: </span>
              

                <a href="/2016/05/11/tcp-package-stick/#ds-thread"><span class="ds-thread-count" data-thread-key="2016/05/11/tcp-package-stick/" data-count-type="comments"></span></a>
              
          </ul>
        </header>
      
      <div class="entry">
        
          
            <h2 id="什么是粘包"><a href="#什么是粘包" class="headerlink" title="什么是粘包"></a>什么是粘包</h2><p>首先请执行以下以下<code>nodejs</code>代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const net = require( &#39;net&#39; );&#10;&#10;const app = net.createServer( connect =&#62; &#123;&#10;&#10;  connect.on( &#39;data&#39;, function ( data ) &#123;&#10;    console.log( data.toString() ); &#10;  &#125; );&#10;&#10;&#125; );&#10;&#10;app.on( &#39;error&#39;, error =&#62; &#123;&#125; );&#10;&#10;app.listen( 8080, &#39;0.0.0.0&#39;, function () &#123;&#10;&#10;  let client = net.connect( &#123; port: 8080, host: &#39;127.0.0.1&#39; &#125; );&#10;&#10;  client.write( &#39;Hi, server!&#39; );&#10;&#10;  client.write( &#39;Hi, server!&#39; );&#10;&#10;&#125; );</span><br></pre></td></tr></table></figure>
<p>你看到的输出一定是 <code>Hi, server!Hi, server!</code>，并且<code>data</code>事件的回调函数只执行了一次，WTF.</p>
<p>将代码稍作修改, 客户端write的时候加一个间隔时间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const net = require( &#39;net&#39; );&#10;&#10;const app = net.createServer( connect =&#62; &#123;&#10;&#10;  connect.on( &#39;data&#39;, function ( data ) &#123;&#10;    console.log( data.toString() ); &#10;  &#125; );&#10;&#10;&#125; );&#10;&#10;app.on( &#39;error&#39;, error =&#62; &#123;&#125; );&#10;&#10;app.listen( 8080, &#39;0.0.0.0&#39;, function () &#123;&#10;&#10;  let client = net.connect( &#123; port: 8080, host: &#39;127.0.0.1&#39; &#125; );&#10;&#10;  client.write( &#39;Hi, server!&#39; );&#10;&#10;  setTimeout( () =&#62; &#123;&#10;    client.write( &#39;Hi, server!&#39; );&#10;  &#125;, 1000 );&#10;&#10;&#125; );</span><br></pre></td></tr></table></figure>
<p>你会看到输出分了两次执行，回调函数也执行了两次，符合了我们的预期，但是，总不能我们的所有代码都加一个延时吧？</p>
<h2 id="为什么会出现粘包？"><a href="#为什么会出现粘包？" class="headerlink" title="为什么会出现粘包？"></a>为什么会出现粘包？</h2><p>网上的解释已经很明确，这里引用一段，出处已经无法考证了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TCP&#26159;&#20010;&#34;&#27969;&#34;&#21327;&#35758;,&#25152;&#35859;&#27969;,&#23601;&#26159;&#27809;&#26377;&#30028;&#38480;&#30340;&#19968;&#20018;&#25968;&#25454;.&#22823;&#23478;&#21487;&#20197;&#24819;&#24819;&#27827;&#37324;&#30340;&#27969;&#27700;,&#26159;&#36830;&#25104;&#19968;&#29255;&#30340;,&#20854;&#38388;&#26159;&#27809;&#26377;&#20998;&#30028;&#32447;&#30340;.&#20294;&#19968;&#33324;&#36890;&#35759;&#31243;&#24207;&#24320;&#21457;&#26159;&#38656;&#35201;&#23450;&#20041;&#19968;&#20010;&#20010;&#30456;&#20114;&#29420;&#31435;&#30340;&#25968;&#25454;&#21253;&#30340;,&#27604;&#22914;&#29992;&#20110;&#30331;&#38470;&#30340;&#25968;&#25454;&#21253;,&#29992;&#20110;&#27880;&#38144;&#30340;&#25968;&#25454;&#21253;.&#30001;&#20110;TCP&#34;&#27969;&#34;&#30340;&#29305;&#24615;&#20197;&#21450;&#32593;&#32476;&#29366;&#20917;,&#22312;&#36827;&#34892;&#25968;&#25454;&#20256;&#36755;&#26102;&#20250;&#20986;&#29616;&#20197;&#19979;&#20960;&#31181;&#24773;&#20917;.&#10;&#20551;&#35774;&#25105;&#20204;&#36830;&#32493;&#35843;&#29992;&#20004;&#27425;send&#20998;&#21035;&#21457;&#36865;&#20004;&#27573;&#25968;&#25454;data1&#21644;data2,&#22312;&#25509;&#25910;&#31471;&#26377;&#20197;&#19979;&#20960;&#31181;&#25509;&#25910;&#24773;&#20917;(&#24403;&#28982;&#19981;&#27490;&#36825;&#20960;&#31181;&#24773;&#20917;,&#36825;&#37324;&#21482;&#21015;&#20986;&#20102;&#26377;&#20195;&#34920;&#24615;&#30340;&#24773;&#20917;).&#10;A.&#20808;&#25509;&#25910;&#21040;data1,&#28982;&#21518;&#25509;&#25910;&#21040;data2.&#10;B.&#20808;&#25509;&#25910;&#21040;data1&#30340;&#37096;&#20998;&#25968;&#25454;,&#28982;&#21518;&#25509;&#25910;&#21040;data1&#20313;&#19979;&#30340;&#37096;&#20998;&#20197;&#21450;data2&#30340;&#20840;&#37096;.&#10;C.&#20808;&#25509;&#25910;&#21040;&#20102;data1&#30340;&#20840;&#37096;&#25968;&#25454;&#21644;data2&#30340;&#37096;&#20998;&#25968;&#25454;,&#28982;&#21518;&#25509;&#25910;&#21040;&#20102;data2&#30340;&#20313;&#19979;&#30340;&#25968;&#25454;.&#10;D.&#19968;&#27425;&#24615;&#25509;&#25910;&#21040;&#20102;data1&#21644;data2&#30340;&#20840;&#37096;&#25968;&#25454;.&#10;&#10;&#23545;&#20110;A&#36825;&#31181;&#24773;&#20917;&#27491;&#26159;&#25105;&#20204;&#38656;&#35201;&#30340;,&#19981;&#20877;&#20570;&#35752;&#35770;.&#23545;&#20110;B,C,D&#30340;&#24773;&#20917;&#23601;&#26159;&#22823;&#23478;&#32463;&#24120;&#35828;&#30340;&#34;&#31896;&#21253;&#34;,&#23601;&#38656;&#35201;&#25105;&#20204;&#25226;&#25509;&#25910;&#21040;&#30340;&#25968;&#25454;&#36827;&#34892;&#25286;&#21253;,&#25286;&#25104;&#19968;&#20010;&#20010;&#29420;&#31435;&#30340;&#25968;&#25454;&#21253;.&#20026;&#20102;&#25286;&#21253;&#23601;&#24517;&#39035;&#22312;&#21457;&#36865;&#31471;&#36827;&#34892;&#23553;&#21253;.&#10;&#10;&#21478;:&#23545;&#20110;UDP&#26469;&#35828;&#23601;&#19981;&#23384;&#22312;&#25286;&#21253;&#30340;&#38382;&#39064;,&#22240;&#20026;UDP&#26159;&#20010;&#34;&#25968;&#25454;&#21253;&#34;&#21327;&#35758;,&#20063;&#23601;&#26159;&#20004;&#27573;&#25968;&#25454;&#38388;&#26159;&#26377;&#30028;&#38480;&#30340;,&#22312;&#25509;&#25910;&#31471;&#35201;&#20040;&#25509;&#25910;&#19981;&#21040;&#25968;&#25454;&#35201;&#20040;&#23601;&#26159;&#25509;&#25910;&#19968;&#20010;&#23436;&#25972;&#30340;&#19968;&#27573;&#25968;&#25454;,&#19981;&#20250;&#23569;&#25509;&#25910;&#20063;&#19981;&#20250;&#22810;&#25509;&#25910;.</span><br></pre></td></tr></table></figure>
<h2 id="如何处理粘包或者半包的情况？"><a href="#如何处理粘包或者半包的情况？" class="headerlink" title="如何处理粘包或者半包的情况？"></a>如何处理粘包或者半包的情况？</h2><p>这里采用了一个类似HTTP的方法，定义一个HTTP头:<code>Content-Length: 100</code>，然后这个数据包的大小就是100，我只需要在读到头数据之后，再读100，就是我这个数据包的带下了，如果数据还有剩下，那么就是下一个包的内容，如果数据不足100，那就说明这里只传了半个包，等待下次<code>data</code>事件触发，后半部分的数据就是这个包里面。</p>
<h3 id="举个例子"><a href="#举个例子" class="headerlink" title="举个例子"></a>举个例子</h3><p>假设我要传送一个数据: <code>hello world!</code>，首先我需要进行封包，一个数据包由头部和身体组成，其中，头部组成如下: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">||||00000012</span><br></pre></td></tr></table></figure>
<p><code>||||</code>这个是头部开始的标示，由服务端和客户端互相约定，<code>00000012</code>，这个是数据体的大小，前面的<code>0</code>为了补全大小位，这里采用了8位，因为默认情况下，TCP的缓冲区大小是8K，8K换成byte就是: 8388608。</p>
<p>所以我们的头部其实固定为12位，那么接下来的就都是数据体，<code>hello world!</code>组成一个数据包之后的样子就是: <code>||||00000012hello world!</code>，服务端的解包就不说了，就是自己维护一个缓冲区，从头开始解就行了。</p>
<h2 id="better-packet"><a href="#better-packet" class="headerlink" title="better-packet"></a>better-packet</h2><p><code>better-packet</code>，提供了一个封包的解包的方法，专门为了用来解决粘包问题，看看使用了<code>better-package</code>之后会怎么样.</p>
<p>server.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const net = require( &#39;net&#39; );&#10;&#10;const betterPacket = require( &#39;./index&#39; );&#10;&#10;const app = net.createServer( ( connect ) =&#62; &#123;&#10;  &#10;  let unpackager = new betterPacket.UnPackager();&#10;&#10;  connect.on( &#39;data&#39;, unpackager.addBuffer.bind( unpackager ) );&#10;&#10;  connect.on( &#39;error&#39;, () =&#62; &#123;&#125; );&#10;&#10;  unpackager.on( &#39;package&#39;, function ( data ) &#123;&#10;&#10;    // Hi, server!&#10;    // Hi, server!&#10;    console.log( data.toString() );&#10;&#10;  &#125; );&#10;&#10;&#125; );&#10;&#10;app.on( &#39;error&#39;, error =&#62; &#123;&#125; );&#10;&#10;app.listen( &#39;8080&#39;, &#39;0.0.0.0&#39; );</span><br></pre></td></tr></table></figure>
<p>client.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const net = require( &#39;net&#39; );&#10;&#10;const betterPacket = require( &#39;./index&#39; );&#10;&#10;const client = net.connect( &#123; port: 8080, host: &#39;127.0.0.1&#39; &#125; );&#10;&#10;const packager = new betterPacket.Packager();&#10;&#10;let sendData = packager.packageData( &#39;Hi, server!&#39; );&#10;&#10;client.write( sendData );&#10;&#10;client.write( sendData );</span><br></pre></td></tr></table></figure>
<p>这里服务端的数据就变得正常了，而且<code>data</code>事件的回调函数也被调了两次。</p>

          
        
      </div>
      <footer>
        
          <div class="alignright">
            <a href="/2016/05/11/tcp-package-stick/#more" class="more-link">Continue Reading<i class="fa fa-long-arrow-right fa-1"></i></a>
          </div>
        
        <div class="clearfix"></div>
      </footer>
    </div>
</article>




  <article class="post">
  
  
    <div class="post-content-index">
  
      
        <header>
          <div class="icon"></div>
            
    
      <h1 class="title transition"><a href="/2016/04/13/the-crazy-adblock/">丧心病狂的adblock</a></h1>
    
  
          <ul>
            <li>
              <span class="heading-span">Posted on: </span>
              <time datetime="2016-04-13T03:06:00.000Z">2016-04-13</time>
            </li>
            
              <li>
                <span class="heading-span">By: </span>

                
                  <a href="/">PerterPon</a>
                

              </li>
            
            <li>
              <span class="heading-span">With: </span>
              

                <a href="/2016/04/13/the-crazy-adblock/#ds-thread"><span class="ds-thread-count" data-thread-key="2016/04/13/the-crazy-adblock/" data-count-type="comments"></span></a>
              
          </ul>
        </header>
      
      <div class="entry">
        
          
            <h4 id="有天在开发一个页面，里面用到了一张图片，图片对应的是一个名字叫ads的数据服务，全称大概是analyse-data-service，分析型数据服务，图片名字就取了一个ads-png，一开始也觉得没啥，就这么开发了，但是测试的时候发现，这张图片死活加载不出来，控制台提示net-ERR-BLOCKED-BY-CLIENT。"><a href="#有天在开发一个页面，里面用到了一张图片，图片对应的是一个名字叫ads的数据服务，全称大概是analyse-data-service，分析型数据服务，图片名字就取了一个ads-png，一开始也觉得没啥，就这么开发了，但是测试的时候发现，这张图片死活加载不出来，控制台提示net-ERR-BLOCKED-BY-CLIENT。" class="headerlink" title="有天在开发一个页面，里面用到了一张图片，图片对应的是一个名字叫ads的数据服务，全称大概是analyse data service，分析型数据服务，图片名字就取了一个ads.png，一开始也觉得没啥，就这么开发了，但是测试的时候发现，这张图片死活加载不出来，控制台提示net::ERR_BLOCKED_BY_CLIENT。"></a>有天在开发一个页面，里面用到了一张图片，图片对应的是一个名字叫ads的数据服务，全称大概是<code>analyse data service</code>，分析型数据服务，图片名字就取了一个<code>ads.png</code>，一开始也觉得没啥，就这么开发了，但是测试的时候发现，这张图片死活加载不出来，控制台提示<code>net::ERR_BLOCKED_BY_CLIENT</code>。</h4><h4 id="一开始以为是图片格式有问题，于是重新转了一下图片，发现问题依旧，单独在新TAB打开这个图片又能正常显示，所以把图片格式问题排除了。"><a href="#一开始以为是图片格式有问题，于是重新转了一下图片，发现问题依旧，单独在新TAB打开这个图片又能正常显示，所以把图片格式问题排除了。" class="headerlink" title="一开始以为是图片格式有问题，于是重新转了一下图片，发现问题依旧，单独在新TAB打开这个图片又能正常显示，所以把图片格式问题排除了。"></a>一开始以为是图片格式有问题，于是重新转了一下图片，发现问题依旧，单独在新TAB打开这个图片又能正常显示，所以把图片格式问题排除了。</h4><h4 id="于是就把问题放到这个报错信息上net-ERR-BLOCKED-BY-CLIENT，blocked-by-client，被客户端，也就是浏览器给拒绝了，难道是返回的头信息有什么问题？server端是webpack起的一个静态文件服务，看了看浏览器的请求记录，发现只有request，都没有response，看来请求都没有走出浏览器。"><a href="#于是就把问题放到这个报错信息上net-ERR-BLOCKED-BY-CLIENT，blocked-by-client，被客户端，也就是浏览器给拒绝了，难道是返回的头信息有什么问题？server端是webpack起的一个静态文件服务，看了看浏览器的请求记录，发现只有request，都没有response，看来请求都没有走出浏览器。" class="headerlink" title="于是就把问题放到这个报错信息上net::ERR_BLOCKED_BY_CLIENT，blocked by client，被客户端，也就是浏览器给拒绝了，难道是返回的头信息有什么问题？server端是webpack起的一个静态文件服务，看了看浏览器的请求记录，发现只有request，都没有response，看来请求都没有走出浏览器。"></a>于是就把问题放到这个报错信息上<code>net::ERR_BLOCKED_BY_CLIENT</code>，blocked by client，被客户端，也就是浏览器给拒绝了，难道是返回的头信息有什么问题？server端是webpack起的一个静态文件服务，看了看浏览器的请求记录，发现只有request，都没有response，看来请求都没有走出浏览器。</h4><h4 id="为了验证上述问题，我把服务停了，然后然后手动更改图片的URL链接，使得重新加载，发现任然报错了，那么就可以确定问题在浏览器端。"><a href="#为了验证上述问题，我把服务停了，然后然后手动更改图片的URL链接，使得重新加载，发现任然报错了，那么就可以确定问题在浏览器端。" class="headerlink" title="为了验证上述问题，我把服务停了，然后然后手动更改图片的URL链接，使得重新加载，发现任然报错了，那么就可以确定问题在浏览器端。"></a>为了验证上述问题，我把服务停了，然后然后手动更改图片的URL链接，使得重新加载，发现任然报错了，那么就可以确定问题在浏览器端。</h4><h4 id="各种google，stackoverflow，baidu，都没有找到一个合适的解答，而且其他图片全都没问题，唯独这张图片加载不出来，尝试用命令行起chrome，然后看看控制台输出，也没看到什么有价值的log。心如死灰之际，起身去了趟厕所，尿尿过程中，想到，不如把图片上传到CDN或者一些云服务试试看。"><a href="#各种google，stackoverflow，baidu，都没有找到一个合适的解答，而且其他图片全都没问题，唯独这张图片加载不出来，尝试用命令行起chrome，然后看看控制台输出，也没看到什么有价值的log。心如死灰之际，起身去了趟厕所，尿尿过程中，想到，不如把图片上传到CDN或者一些云服务试试看。" class="headerlink" title="各种google，stackoverflow，baidu，都没有找到一个合适的解答，而且其他图片全都没问题，唯独这张图片加载不出来，尝试用命令行起chrome，然后看看控制台输出，也没看到什么有价值的log。心如死灰之际，起身去了趟厕所，尿尿过程中，想到，不如把图片上传到CDN或者一些云服务试试看。"></a>各种google，stackoverflow，baidu，都没有找到一个合适的解答，而且其他图片全都没问题，唯独这张图片加载不出来，尝试用命令行起chrome，然后看看控制台输出，也没看到什么有价值的log。心如死灰之际，起身去了趟厕所，尿尿过程中，想到，不如把图片上传到CDN或者一些云服务试试看。</h4><h4 id="回来立马就传到了OTS上，因为传上去之后文件名会被改变，变成了一些自动生成的信息，然后把网址拿过来，放到了页面上，居然神奇得发现图片能正常显示了，看来找对了方向，和之前的一对比，马上就发现了文件名上有一些不一样，再一看之前的文件名ads，不就是广告么，一下就想到了adblock，至此，折腾了这么久，总算是找到原因了，也找到元凶-adblock，不过这也算是adblock的一个策略吧，从文件名上入手，去搜索了一下adblock的一些别的策略，谨防再次入坑。"><a href="#回来立马就传到了OTS上，因为传上去之后文件名会被改变，变成了一些自动生成的信息，然后把网址拿过来，放到了页面上，居然神奇得发现图片能正常显示了，看来找对了方向，和之前的一对比，马上就发现了文件名上有一些不一样，再一看之前的文件名ads，不就是广告么，一下就想到了adblock，至此，折腾了这么久，总算是找到原因了，也找到元凶-adblock，不过这也算是adblock的一个策略吧，从文件名上入手，去搜索了一下adblock的一些别的策略，谨防再次入坑。" class="headerlink" title="回来立马就传到了OTS上，因为传上去之后文件名会被改变，变成了一些自动生成的信息，然后把网址拿过来，放到了页面上，居然神奇得发现图片能正常显示了，看来找对了方向，和之前的一对比，马上就发现了文件名上有一些不一样，再一看之前的文件名ads，不就是广告么，一下就想到了adblock，至此，折腾了这么久，总算是找到原因了，也找到元凶: adblock，不过这也算是adblock的一个策略吧，从文件名上入手，去搜索了一下adblock的一些别的策略，谨防再次入坑。"></a>回来立马就传到了OTS上，因为传上去之后文件名会被改变，变成了一些自动生成的信息，然后把网址拿过来，放到了页面上，居然神奇得发现图片能正常显示了，看来找对了方向，和之前的一对比，马上就发现了文件名上有一些不一样，再一看之前的文件名<code>ads</code>，不就是广告么，一下就想到了adblock，至此，折腾了这么久，总算是找到原因了，也找到元凶: <code>adblock</code>，不过这也算是adblock的一个策略吧，从文件名上入手，去搜索了一下adblock的一些别的策略，谨防再次入坑。</h4>
          
        
      </div>
      <footer>
        
          <div class="alignright">
            <a href="/2016/04/13/the-crazy-adblock/#more" class="more-link">Continue Reading<i class="fa fa-long-arrow-right fa-1"></i></a>
          </div>
        
        <div class="clearfix"></div>
      </footer>
    </div>
</article>




  <article class="post">
  
  
    <div class="post-content-index">
  
      
        <header>
          <div class="icon"></div>
            
    
      <h1 class="title transition"><a href="/2016/04/12/nodejs-in-the-world/">nodejs在世界范围内的大型应用</a></h1>
    
  
          <ul>
            <li>
              <span class="heading-span">Posted on: </span>
              <time datetime="2016-04-12T11:35:00.000Z">2016-04-12</time>
            </li>
            
              <li>
                <span class="heading-span">By: </span>

                
                  <a href="/">PerterPon</a>
                

              </li>
            
            <li>
              <span class="heading-span">With: </span>
              

                <a href="/2016/04/12/nodejs-in-the-world/#ds-thread"><span class="ds-thread-count" data-thread-key="2016/04/12/nodejs-in-the-world/" data-count-type="comments"></span></a>
              
          </ul>
        </header>
      
      <div class="entry">
        
          
            <h2 id="paypal"><a href="#paypal" class="headerlink" title="paypal"></a>paypal</h2><p>实现相同的功能，2个人用nodejs干了5个人以前用java干的活，性能提高一倍，代码量减少33%，文件减少了40%。</p>
<p>nodejs 基金会主席：Danese Cooper，2014年加入paypal。</p>
<h2 id="Microsoft"><a href="#Microsoft" class="headerlink" title="Microsoft"></a>Microsoft</h2><p>微软自家研发的JS引擎：<a href="https://github.com/nodejs/node-chakracore" target="_blank" rel="external">chakra</a>，主要用来解决在跑在ARM上的windows系统不支持nodejs的问题，微软已经有意向提PR到nodejs主分支上去。</p>
<h2 id="Uber"><a href="#Uber" class="headerlink" title="Uber"></a>Uber</h2><p>整个Uber的分布式调度系统都是基于nodejs和redis开发。</p>
<p>API层的业务逻辑基于python，mysql和mongo。</p>
<h2 id="Groupon"><a href="#Groupon" class="headerlink" title="Groupon"></a>Groupon</h2><p>原先使用Ruby on Rails，有一次大家PK完之后，发现了nodejs的带来的好处，所以转换成nodejs开发，2013年宣布成功从ROR迁移至nodejs。</p>
<p>目前现在Groupon的技术架构：web front-end mvc / mobile client &lt;–&gt; json &lt;–&gt; nodejs &lt;–&gt; service server</p>
<p>service server可能也是nodejs。</p>
<h2 id="New-York-Times"><a href="#New-York-Times" class="headerlink" title="New York Times"></a>New York Times</h2><p>移动端核心业务使用nodejs, Express作为web框架，使用dust.js作为模板渲染，所有node代码用coffeeScript，同时使用redis作为node层和核心业务层之间的缓存。</p>
<h2 id="GitHub"><a href="#GitHub" class="headerlink" title="GitHub"></a>GitHub</h2><p>找到的资料不多，只找到一条Twitter，是GitHub官网账号在2010年12月20日发布的.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Git tag/branch downloads aren&#39;t working current.  We&#39;re upgrading Node.js.</span><br></pre></td></tr></table></figure>
<h2 id="NASA"><a href="#NASA" class="headerlink" title="NASA"></a>NASA</h2><p>因为其背景，找到的资料也不多，2008年5月份的时候，<code>nodesource.com</code>的CEO发布了一条Twitter</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Welcome to #Nodejs at NASA&#12290;</span><br></pre></td></tr></table></figure>
<h2 id="沃尔玛"><a href="#沃尔玛" class="headerlink" title="沃尔玛"></a>沃尔玛</h2><p>沃尔玛实验室，在Github上有自己的主页，发布了很多项目，大部分都跟nodejs还有javascript有关，有自己的nodejs框架：<code>hapi</code>，提供restful的API服务，以配置为核心，提供鉴权需求、输入验证、数据缓存和预加载等功能。<br>另外还有<code>hoek</code>、<code>flod</code>、<code>lout</code>、<code>MUPD8</code>、<code>Lumbar</code>等很多服务于nodejs的工具。</p>

          
        
      </div>
      <footer>
        
          <div class="alignright">
            <a href="/2016/04/12/nodejs-in-the-world/#more" class="more-link">Continue Reading<i class="fa fa-long-arrow-right fa-1"></i></a>
          </div>
        
        <div class="clearfix"></div>
      </footer>
    </div>
</article>





<nav id="pagination">
  
  
    <a href="/page/2/" class="alignright next">下一頁</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright"><div class="padding">
	
	  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜尋">
    <input type="hidden" name="q" value="site:yoursite.com">
  </form>
</div>
	
	  
<div class="widget recent-post">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2016/12/07/effective-pixel/">获取最小有效像素区域</a>
      </li>
    
      <li>
        <a href="/2016/11/23/computer-number/">计算机眼中的数字</a>
      </li>
    
      <li>
        <a href="/2016/11/23/async/">相对性推进引擎(emDrive)</a>
      </li>
    
      <li>
        <a href="/2016/11/23/em-drive/"></a>
      </li>
    
      <li>
        <a href="/2016/11/16/ios-basic/">iOS开发--1天从入门到放弃--基础</a>
      </li>
    
  </ul>
</div>

	
	  
<div class="widget category">
  <h3 class="title">分類</h3>
  <ul class="entry">
  
    <li><a href="/categories/Objective-C/">Objective-C</a><small>2</small></li>
  
    <li><a href="/categories/basis/">basis</a><small>1</small></li>
  
    <li><a href="/categories/canvas/">canvas</a><small>1</small></li>
  
    <li><a href="/categories/coffee-script/">coffee-script</a><small>1</small></li>
  
    <li><a href="/categories/iOS/">iOS</a><small>1</small></li>
  
    <li><a href="/categories/id2/">id2</a><small>5</small></li>
  
    <li><a href="/categories/mysql/">mysql</a><small>1</small></li>
  
    <li><a href="/categories/node/">node</a><small>1</small></li>
  
    <li><a href="/categories/physical/">physical</a><small>2</small></li>
  
    <li><a href="/categories/spider/">spider</a><small>1</small></li>
  
  </ul>
</div>

	
	  
<div class="widget tag">
  <h3 class="title">標籤</h3>
  
    <a href="/tags/Google/">Google<small>1</small></a>
  
    <a href="/tags/Javascript/">Javascript<small>1</small></a>
  
    <a href="/tags/OSX/">OSX<small>1</small></a>
  
    <a href="/tags/adblock/">adblock<small>1</small></a>
  
    <a href="/tags/basic/">basic<small>1</small></a>
  
    <a href="/tags/better-package/">better package<small>1</small></a>
  
    <a href="/tags/blog/">blog<small>1</small></a>
  
    <a href="/tags/canvas/">canvas<small>1</small></a>
  
    <a href="/tags/co/">co<small>1</small></a>
  
    <a href="/tags/coffee-script/">coffee-script<small>1</small></a>
  
    <a href="/tags/complicating/">complicating<small>1</small></a>
  
    <a href="/tags/computer/">computer<small>1</small></a>
  
    <a href="/tags/cover/">cover<small>1</small></a>
  
    <a href="/tags/dataplus/">dataplus<small>1</small></a>
  
    <a href="/tags/decimal/">decimal<small>1</small></a>
  
    <a href="/tags/drive/">drive<small>1</small></a>
  
    <a href="/tags/emDrive/">emDrive<small>1</small></a>
  
    <a href="/tags/float/">float<small>1</small></a>
  
    <a href="/tags/hexo/">hexo<small>1</small></a>
  
    <a href="/tags/http/">http<small>1</small></a>
  
    <a href="/tags/iOS/">iOS<small>1</small></a>
  
    <a href="/tags/id2/">id2<small>1</small></a>
  
    <a href="/tags/javascript/">javascript<small>1</small></a>
  
    <a href="/tags/js/">js<small>1</small></a>
  
    <a href="/tags/json/">json<small>1</small></a>
  
    <a href="/tags/kaggle/">kaggle<small>1</small></a>
  
    <a href="/tags/knn/">knn<small>1</small></a>
  
    <a href="/tags/lock/">lock<small>1</small></a>
  
    <a href="/tags/members/">members<small>1</small></a>
  
    <a href="/tags/microwave/">microwave<small>1</small></a>
  
    <a href="/tags/mysql/">mysql<small>1</small></a>
  
    <a href="/tags/node/">node<small>3</small></a>
  
    <a href="/tags/number/">number<small>1</small></a>
  
    <a href="/tags/objective-c/">objective-c<small>1</small></a>
  
    <a href="/tags/package/">package<small>1</small></a>
  
    <a href="/tags/pai/">pai<small>1</small></a>
  
    <a href="/tags/physical/">physical<small>1</small></a>
  
    <a href="/tags/pixel/">pixel<small>1</small></a>
  
    <a href="/tags/precision/">precision<small>1</small></a>
  
    <a href="/tags/quantum/">quantum<small>1</small></a>
  
    <a href="/tags/reCAPTCHA/">reCAPTCHA<small>1</small></a>
  
    <a href="/tags/spider/">spider<small>1</small></a>
  
    <a href="/tags/tcp/">tcp<small>1</small></a>
  
    <a href="/tags/upload/">upload<small>1</small></a>
  
    <a href="/tags/uploadify/">uploadify<small>1</small></a>
  
    <a href="/tags/yosemite/">yosemite<small>1</small></a>
  
</div>

	
</div></aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="padding">
	<div class="alignleft">
	  
	  &copy; 2016 PerterPon
	  
	  Powerd by <a href="http://hexo.io/" target="_blank">hexo</a>
	  and Theme by <a href="https://github.com/halfer53/metro-light" target="_blank">metro-light</a>
	</div>

	<div class="alignright">
		
		
			<a href="https://github.com/PerterPon" target="_blank" title="PerterPon Github"><i class="fa fa-github-square"></i></a>	
		
		
		
		
		
		
	</div>

	<div class="clearfix"></div>
</div>

<div class="scroll-top"><i class="fa fa-arrow-circle-up"></i></div>
<div>&nbsp;</div>
<div class="record">ICP证: 浙ICP备14031346号-1</div></footer>
  

 <script type="text/javascript">
var duoshuoQuery = {short_name:"perterpon"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>



<script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/3.0.4/jquery.imagesloaded.js"></script>
<script src="/js/gallery.js"></script>



<script type="text/javascript">
$(window).scroll(function() {

    if($(this).scrollTop() > 400) {
        $('.scroll-top').fadeIn(200);
    } else {
        $('.scroll-top').fadeOut(200);
    }
});

$('.scroll-top').bind('click', function(e) {
    e.preventDefault();
    $('body,html').animate({scrollTop:0},200);
});
</script>


<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F843c2a3226de23e0cfbb9668a390e06f' type='text/javascript'%3E%3C/script%3E"));
</script>
</body>
</html>
